{% extends "core/base.html" %}
{% load static %}

{% block title %}Profile{% endblock %}
{% block imports %}
<link rel="stylesheet" href={% static 'core/charles.css' %} />
<link rel="stylesheet" href={% static 'core/account.css' %} />
{% endblock %}

{% block content %}
<h1>Profile</h1>
<div class="content-section">
  <div class="media">
    {% if user.profile.img.url %}
    <img class="rounded-circle account-img" src="{{ user.profile.img.url }}">
    {% else %}
    <img src={% static 'core/user.jpg' %}>
    {% endif %}
  </div>

  <form method="POST" enctype="multipart/form-data" class="card">
    {% csrf_token %}
    <h4>Update Profile</h4>
    {{ update_form }}
    {{ profile_form }}
    <button class="btn btn-outline-info" type="submit">Update</button>

  </form>

  <div id="tabs" class="card">
    <!-- Tab links -->
    <div id="tablinks-container">
      <button class="tablinks active" onclick="openTab(event, 'Search')">Search</button>
      <button class="tablinks" onclick="openTab(event, 'Friends')">Friends</button>
      <button class="tablinks" onclick="openTab(event, 'Requests')">Requests</button>
    </div>

    <!-- Tab content -->
    <div id="Friends" class="tabcontent" style="display:none">
      <table class="All friends table">
        <tr>
          <th>
            <h4>Friends</h4>
          </th>
        </tr>
        {% for user in friends %}
        {% if not user.is_superuser %}
        {% if not user == request.user %}
        <tr>
          <td>{{ user }}</td>
        </tr>
        {% endif %}
        {% endif %}
        {% endfor %}
      </table>
    </div>

    <div id="Search" class="tabcontent" id="defaultOpen">
      <form method="get">
        {{ friend_filter.form }}
      </form>

      <table class="friends table">
        <tr>
          <th style="text-align:left">Users</th>
        </tr>
        {% for user in allusers %}
        {% if not user.is_superuser %}
        {% if not user == request.user %}
        {% if not user in friends %}
        <tr>
          <td>{{user.username}}</td>
          <td>
            <a href="/send_friend_request/{{ user.id }}/">
              <input type="button" value="Send Request">
            </a>
          </td>
        </tr>
        {% else %}
        <tr>
          <td>{{user.username}}</td>
          <td>Friend</td>
        </tr>
        {% endif %}
        {% endif %}
        {% endif %}
        {% endfor %}
      </table>
    </div>

    <div id="Requests" class="tabcontent" style="display:none">
      <h4>Requests</h4>
      {% if allrequests|length != 0 %}
        {% for friend_request in allrequests %}
        {% if friend_request.from_user != request.user %}
        <h4>
          {{ friend_request.from_user }}
        </h4>
        <a href="/accept_friend_request/{{friend_request.id}}/">
          <input type="button" value="Accept">
        </a>
        <a href="/decline_friend_request/{{friend_request.id}}/">
          <input type="button" value="Decline">
        </a>
        {% endif %}
        {% endfor %}
      {% else %}
        <p>No Requests</p>
      {% endif %}
    </div>
  </div>
</div>

<script src={% static 'core/script.js' %}></script>
{% endblock %}
